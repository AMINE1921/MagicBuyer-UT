// ==UserScript==
// @name        MagicBuyer-UT
// @version     2.0.0
// @author      AMINE1921
// @description UT Auto Buyer - French version
// @match       https://www.ea.com/*/ea-sports-fc/ultimate-team/web-app/*
// @match       https://www.ea.com/ea-sports-fc/ultimate-team/web-app/*
// @namespace   http://tampermonkey.net/
// @grant       GM_xmlhttpRequest
// @connect     ea.com
// @connect     ea2.com
// @connect     futbin.com
// @connect     futwiz.com
// @connect     discordapp.com
// @connect     futbin.org
// @connect     exp.host
// @require     https://code.jquery.com/jquery-3.6.1.min.js
// @require     https://github.com/AMINE1921/MagicBuyer-UT/releases/latest/download/fut-trade-enhancer.user.js
// @updateURL   https://github.com/AMINE1921/MagicBuyer-UT/releases/latest/download/fut-auto-buyer.user.js
// @downloadURL https://github.com/AMINE1921/MagicBuyer-UT/releases/latest/download/fut-auto-buyer.user.js
// @noFrame     
// ==/UserScript==

(()=>{var e={897:()=>{const e=window.fetch;window.fetch=function(t,n){if(t&&(/discordapp/.test(t)||/exp.host/.test(t))&&("POST"===n.method||"DELETE"===n.method))return new Promise(((e,i)=>{const s=Object.assign({},n.headers,{"User-Agent":"From Node"});GM_xmlhttpRequest({method:n.method,headers:s,url:t,data:n.body,onload:t=>{200===t.status||204===t.status?(t.text=()=>new Promise((e=>e(t.responseText))),t.headers=t.responseHeaders.split("\r\n").reduce((function(e,t){var n=t.split(": ");return e.set(n[0],n[1]),e}),new Map),e(t)):i(t)}})}));return e.call(this,t,n)}}},t={};function n(i){var s=t[i];if(void 0!==s)return s.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,n),o.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e={};n.r(e),n.d(e,{idAbActiveTransfers:()=>He,idAbAddBuyDelay:()=>ce,idAbAddFilterGK:()=>ue,idAbAvailableItems:()=>Ve,idAbBidExact:()=>q,idAbBidFutBin:()=>$t,idAbBuyPrice:()=>H,idAbCardCount:()=>z,idAbCloseTabToggle:()=>pe,idAbCoins:()=>ke,idAbCountDown:()=>xt,idAbCustomDiscordNameNotificationToggle:()=>fe,idAbCycleAmount:()=>Z,idAbDelayToAdd:()=>de,idAbDontMoveWon:()=>At,idAbDownloadFilter:()=>rt,idAbDownloadStats:()=>Bt,idAbFiltersFileToUpload:()=>gt,idAbFiltersToUpload:()=>at,idAbIgnoreAllowToggle:()=>yt,idAbItemExpiring:()=>G,idAbMaxBid:()=>j,idAbMaxPurchases:()=>Lt,idAbMaxRating:()=>ie,idAbMaxSearchPage:()=>le,idAbMessageNotificationToggle:()=>me,idAbMinDeleteCount:()=>X,idAbMinRating:()=>ne,idAbNumberFilterSearch:()=>ze,idAbOverSearchWarning:()=>Ut,idAbPauseFor:()=>ee,idAbProfit:()=>lt,idAbRandMinBidInput:()=>se,idAbRandMinBidToggle:()=>ae,idAbRandMinBuyInput:()=>oe,idAbRandMinBuyToggle:()=>re,idAbReportProblem:()=>Tt,idAbRequestCount:()=>Re,idAbResumeAfterErrorOccured:()=>Ct,idAbSearchProgress:()=>Fe,idAbSearchResult:()=>J,idAbSellPrice:()=>Y,idAbSellToggle:()=>K,idAbSendListingNotificationToggle:()=>ge,idAbShouldSort:()=>_t,idAbSoldItems:()=>We,idAbSolveCaptcha:()=>De,idAbSortBy:()=>Pt,idAbSortOrder:()=>It,idAbSoundToggle:()=>be,idAbStatisticsProgress:()=>Ee,idAbStatus:()=>Le,idAbStopAfter:()=>te,idAbStopErrorCode:()=>je,idAbStopErrorCodeCount:()=>Je,idAbToggleRunner:()=>St,idAbUnsoldItems:()=>Oe,idAbUploadBtn:()=>bt,idAbUploadFilter:()=>ot,idAbUseFutWiz:()=>Wt,idAbWaitTime:()=>Q,idAddIgnorePlayers:()=>ut,idAddIgnorePlayersList:()=>mt,idAntiCaptchKey:()=>Ze,idAutoClearExpired:()=>ht,idAutoClearLog:()=>tt,idBtnActions:()=>Mt,idBtnReport:()=>Dt,idBuyFutBinPercent:()=>wt,idBuyFutBinPrice:()=>vt,idCalcBinPrice:()=>Pe,idCapatchaMp3:()=>Ye,idClearLogButton:()=>Be,idDeleteFilter:()=>Me,idDiscordChannelId:()=>Se,idDiscordToken:()=>we,idFUTMarketAlertToken:()=>$e,idFilterDropdown:()=>W,idFilterDropdownHeader:()=>O,idFinishMp3:()=>Rt,idFutBinDuration:()=>ft,idInfoWrapper:()=>Te,idLog:()=>kt,idNotificationType:()=>ve,idPreserveChanges:()=>xe,idProgressAutobuyer:()=>Ae,idProxyAddress:()=>Xe,idProxyLogin:()=>Qe,idProxyPassword:()=>et,idProxyPort:()=>Ke,idRemoveIgnorePlayers:()=>pt,idRunFilterSequential:()=>dt,idSearchCancelButton:()=>Ce,idSearchWrapper:()=>Ge,idSelectFilterCount:()=>_e,idSelectedFilter:()=>V,idSellAfterTax:()=>Ne,idSellCheckBuyPrice:()=>ct,idSellFutBinPercent:()=>st,idSellFutBinPrice:()=>it,idSellRatingThreshold:()=>nt,idSession:()=>Ft,idTelegramBotToken:()=>he,idTelegramChatId:()=>ye,idTestNotification:()=>Ie,idTooltip:()=>Nt,idWebHookUrl:()=>Et,idWinCount:()=>Ue,idWinMp3:()=>qe});var t={};n.r(t),n.d(t,{R:()=>Hi,T:()=>zi});const i="Paused",s="Stopped",o={521:"Request Rejected",512:"Request Rejected",429:"Too many request from this user",426:"Other user won the (card / bid)",461:"Other user won the (card / bid)"},r={idBuyFutBinPercent:95,idAbCardCount:1e3,idAbCardCountisDefaultValue:!0,idAbItemExpiring:"1H",idAbItemExpiringisDefaultValue:!0,idAbSearchResult:21,idAbSearchResultisDefaultValue:!0,idSellFutBinPercent:"105-110",idFutBinDuration:"1H",idFutBinDurationisDefaultValue:!0,idAbMinDeleteCount:10,idSellRatingThreshold:100,idSellRatingThresholdisDefaultValue:!0,idAbMinRating:10,idAbMinRatingisDefaultValue:!0,idAbMaxRating:100,idAbMaxRatingisDefaultValue:!0,idAbMaxSearchPage:5,idAbMaxSearchPageisDefaultValue:!0,idAbRandMinBidInput:300,idAbRandMinBidInputisDefaultValue:!0,idAbRandMinBuyInput:300,idAbRandMinBuyInputisDefaultValue:!0,idBuyFutBinPrice:!0,idSellFutBinPrice:!0,idSellCheckBuyPrice:!0,idAbSellToggle:!1,idAbRandMinBidToggle:!0},a={idAbAddBuyDelay:!0,idAbCycleAmount:"15-20",idAbDelayToAdd:"3S",idAbMaxPurchases:1,idAbNumberFilterSearch:3,idAbNumberFilterSearchisDefaultValue:!0,idAbPauseFor:"15-30S",idAbSoundToggle:!0,idAbStopAfter:"1-2H",idAbStopErrorCodeCount:3,idAbWaitTime:"5-8",idAbWaitTimeisDefaultValue:!1,idAutoClearExpired:!0,idAutoClearLog:!0},l=!!window.ReactNativeWebView;let c;const d=()=>{let e=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.shimIndexedDB).open("userDatasAB",2);e.onupgradeneeded=function(t){c=e.result;try{t.oldVersion<1&&c.createObjectStore("Filters",{keyPath:"filterName"}),t.oldVersion<2&&c.createObjectStore("CommonSettings",{keyPath:"filterName"})}catch(t){}},e.onsuccess=function(){c=e.result}},u=e=>new Promise(((t,n)=>{const i=c.transaction("Filters","readwrite");i.objectStore("Filters").delete(e),i.oncomplete=function(){t()},i.onerror=function(){n()}})),p=(e,t,n="Filters")=>new Promise(((i,s)=>{const o=c.transaction(n,"readwrite");o.objectStore(n).put({filterName:e,jsonData:t}),o.oncomplete=function(){i()},o.onerror=function(){s()}})),m=(e="Filters")=>new Promise(((t,n)=>{const i=c.transaction(e,"readonly").objectStore(e).getAll();i.onsuccess=function(){const e={};if(i.result.length)for(let t=0;t<i.result.length;t++)e[i.result[t].filterName]=i.result[t].jsonData;t(e)},i.onerror=function(){n()}})),f=(e="Filters")=>m(e),g=(e,t,n="Filters")=>p(e,t,n),b=new Map,h=(e,t)=>{b.set(e,t)},y=e=>{const t=b.get(e);return t&&t.expiryTimeStamp&&t.expiryTimeStamp<Date.now()?(b.delete(e),null):t},v=(e=!1)=>{const t=y("BuyerSettings")||{};if(e)return t;const n=y("CommonSettings")||{};return Object.assign({},t,n)},w=e=>{let t=y(e)||0;return t++,h(e,t),t},S=()=>((y("CommonSettings")||{}).idAbUseFutWiz?"futwiz":"futbin").toUpperCase(),A=()=>{let e=window.XMLHttpRequest.prototype.open;window.XMLHttpRequest.prototype.open=function(t,n,i){this.addEventListener("readystatechange",(function(){if(4===this.readyState)if(l&&this.responseURL.includes("/ut/game/fifa23/usermassinfo")){let e=JSON.parse(this.responseText);if(e){const{personaId:t,personaName:n}=e.userInfo,i=y("useremail");window.ReactNativeWebView.postMessage(JSON.stringify({payload:{personaId:t,personaName:n,userEmail:i,language:services.Localization.locale.language},type:"initUser"}))}}else if(l&&this.responseURL.includes("/ut/game/fifa23/tradepile")){let e=JSON.parse(this.responseText);if(e){const t=e.auctionInfo.filter((e=>e.itemData.assetId)).map((({itemData:e})=>{const{id:t,assetId:n,definitionId:i,rareflag:s,rating:o}=e;return{id:t,assetId:n,definitionId:i,rareflag:s,rating:o}}));window.ReactNativeWebView.postMessage(JSON.stringify({payload:t,type:"transferList"}))}}else if(this.responseURL.includes("https://gateway.ea.com/proxy/identity/pids/me")){let e=JSON.parse(this.responseText);e&&e.pid&&!y("useremail")&&h("useremail",e.pid.email)}}),!1),e.call(this,t,n,i)}},C=e=>{let t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(var i=0;i<e;i++)t+=n.charAt(Math.floor(62*Math.random()));return t},T=async(e=1)=>{const t=Math.floor(Math.random());await new Promise((n=>setTimeout(n,1e3*(t+e))))},x=(e,t)=>{window.ReactNativeWebView.postMessage(JSON.stringify({type:"downloadFile",payload:{data:JSON.stringify(e,null,4),fileName:t}}))},B=(e,t)=>{window.ReactNativeWebView.postMessage(JSON.stringify({type:"downloadFile",payload:{data:e,fileName:t}}))},P=(e,t)=>{const n="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e,null,4)),i=document.createElement("a");i.setAttribute("href",n),i.setAttribute("download",`${t}.json`),document.body.appendChild(i),i.click(),document.body.removeChild(i)},I=(e,t)=>{const n="data:text/csv;charset=utf-8,%EF%BB%BF"+encodeURIComponent(e),i=document.createElement("a");i.setAttribute("href",n),i.setAttribute("download",`${t}.csv`),document.body.appendChild(i),i.click(),document.body.removeChild(i)},_=e=>{if(e){let t=(e+="")[e.length-1].toUpperCase(),n=D(e.substring(0,e.length-1))/1e3;return n&&(n*="M"===t?60:"H"===t?3600:1),n}return 0},M=e=>{const t=E(e);return t.length>=2?F(t[0],t[1]):t[0]||0},D=e=>{if(e){const[t,n]=e.split("-").map((e=>parseInt(e)));return 1e3*Math.round(Math.random()*(n-t)+t)}return 0},N=e=>{if(e){let t=e[e.length-1].toUpperCase(),n=parseInt(e.substring(0,e.length-1));return n&&(n*="M"===t?60:"H"===t?3600:1),n}return 0},F=(e,t)=>Math.round(Math.random()*(t-e)+e),E=e=>e?(e+"").split("-").map((e=>parseInt(e))):[],R=(e,t)=>(e.length<=t&&(e+=" ".repeat(t-e.length)),e),k=function(e){const t=v();if(!l&&t.idAbSoundToggle){let t=document.getElementById(qe);"capatcha"==e?t=document.getElementById(Ye):"finish"==e?t=document.getElementById(Rt):"cardWon"==e&&(t=document.getElementById(qe)),t.currentTime=0,t.play()}},U=function(e){if(!e)return 0;var t=(new Date).getTime();return Math.max(0,e.end-t)/(e.end-e.start)*100},L=function(t){for(let n of Object.keys(t)){const i=t[n];if(t[n+"isDefaultValue"])continue;const s=`#${e[n]}`;if("boolean"==typeof i){if(i){$(s).addClass("toggled");continue}$(s).removeClass("toggled")}else $(s).val(i)}},W="elem_"+C(15),O="elem_"+C(15),V="elem_"+C(15),H="elem_"+C(15),z="elem_"+C(15),j="elem_"+C(15),J="elem_"+C(15),G="elem_"+C(15),q="elem_"+C(15),Y="elem_"+C(15),X="elem_"+C(15),K="elem_"+C(15),Q="elem_"+C(15),Z="elem_"+C(15),ee="elem_"+C(15),te="elem_"+C(15),ne="elem_"+C(15),ie="elem_"+C(15),se="elem_"+C(15),oe="elem_"+C(15),re="elem_"+C(15),ae="elem_"+C(15),le="elem_"+C(15),ce="elem_"+C(15),de="elem_"+C(15),ue="elem_"+C(15),pe="elem_"+C(15),me="elem_"+C(15),fe="elem_"+C(15),ge="elem_"+C(15),be="elem_"+C(15),he="elem_"+C(15),ye="elem_"+C(15),ve="elem_"+C(15),we="elem_"+C(15),Se="elem_"+C(15),$e="elem_"+C(15),Ae="elem_"+C(15),Ce="elem_"+C(15),Te="elem_"+C(15),xe="elem_"+C(15),Be="elem_"+C(15),Pe="elem_"+C(15),Ie="elem_"+C(15),_e="elem_"+C(15),Me="elem_"+C(15),De="elem_"+C(15),Ne="elem_"+C(15),Fe="elem_"+C(15),Ee="elem_"+C(15),Re="elem_"+C(15),ke="elem_"+C(15),Ue="elem_"+C(15),Le="elem_"+C(15),We="elem_"+C(15),Oe="elem_"+C(15),Ve="elem_"+C(15),He="elem_"+C(15),ze="elem_"+C(15),je="elem_"+C(15),Je="elem_"+C(15),Ge="elem_"+C(15),qe="elem_"+C(15),Ye="elem_"+C(15),Xe="elem_"+C(15),Ke="elem_"+C(15),Qe="elem_"+C(15),Ze="elem_"+C(15),et="elem_"+C(15),tt="elem_"+C(15),nt="elem_"+C(15),it="elem_"+C(15),st="elem_"+C(15),ot="elem_"+C(15),rt="elem_"+C(15),at="elem_"+C(15),lt="elem_"+C(15),ct="elem_"+C(15),dt="elem_"+C(15),ut="elem_"+C(15),pt="elem_"+C(15),mt="elem_"+C(15),ft="elem_"+C(15),gt="elem_"+C(15),bt="elem_"+C(15),ht="elem_"+C(15),yt="elem_"+C(15),vt="elem_"+C(15),wt="elem_"+C(15),St="elem_"+C(15),$t="elem_"+C(15),At="elem_"+C(15),Ct="elem_"+C(15),Tt="elem_"+C(15),xt="elem_"+C(15),Bt="elem_"+C(15),Pt="elem_"+C(15),It="elem_"+C(15),_t="elem_"+C(15),Mt="elem_"+C(15),Dt="elem_"+C(15),Nt="elem_"+C(15),Ft=C(15),Et="elem_"+C(15),Rt="elem_"+C(15),kt="elem_"+C(15),Ut="elem_"+C(15),Lt="elem_"+C(15),Wt="elem_"+C(15);h("sessionStats",{soldItems:"-",unsoldItems:"-",activeTransfers:"-",availableItems:"-",coins:"-",winCount:0,coinsNumber:0,previousPause:0,searchCount:0,profit:0,transactions:[],searchPerMinuteCount:0});const Ot=()=>{const e=U(y("searchInterval")),t=y("sessionStats");$("#"+Re).html(t.searchCount),$("#"+lt).html(t.profit),$("#"+ke).html(t.coins),$("#"+Ue).html(t.winCount),$("#"+Fe).css("width",e),Ht()},Vt=()=>{const e=U(y("searchInterval")),t=y("sessionStats");$("#"+Fe).css("width",e),$("#"+Ee).css("width",e),$("#"+ke).html(t.coins),$("#"+Ue).html(t.winCount),$("#"+Re).html(t.searchCount),$("#"+We).html(t.soldItems),$("#"+Oe).html(t.unsoldItems),$("#"+Ve).html(t.availableItems),$("#"+He).html(t.activeTransfers),$("#"+lt).html(t.profit),Ht(),t.unsoldItems?$("#"+Oe).css("color","red"):$("#"+Oe).css("color",""),t.availableItems?$("#"+Ve).css("color","orange"):$("#"+Ve).css("color","")},Ht=()=>{const e=y("botStartTime");if(e&&y("autoBuyerActive")){const t=Math.abs(new Date-e)/1e3,n=Math.floor(t/60/60%24),i=Math.floor(t/60%60),s=Math.floor(t%60),o=(n<10?"0":"")+n+":"+(i<10?"0":"")+i+":"+(s<10?"0":"")+s;$("#"+xt).html(o),zt("runningTime",o)}},zt=(e,t)=>{const n=y("sessionStats");n[e]=t,h("sessionStats",n)},jt=e=>y("sessionStats")[e]||0,Jt=function(e,t,n){const i=new UTStandardButtonControl;if(i.init(),i.addTarget(i,t,EventType.TAP),i.setText(e),n){const e=n.split(" ");for(let t of e)i.getRootElement().classList.add(t)}return i},Gt=()=>{$("#"+Ae).empty()};let qt=new Set;const Yt=(e,t,n,i,s=!1)=>{const o=y(t)||{};"number"===i&&(n=parseInt(n)),o[e]=n||null,o[e+"isDefaultValue"]=s,h(t,o)},Xt=(e,t,n,i,s,o="number",r=".*",a="buyer-settings-field",l=null)=>{const c=Object.keys(n)[0];return t&&(l&&l(t),Yt(c,s,t,o,!0)),qt.has(c)||($(document).on("input",`#${n[c]}`,(({target:{value:e}})=>{l&&l(e),Yt(c,s,e||t,o,!e)})),qt.add(c)),`<div class="price-filter ${a}">\n       <div class="info">\n           <span class="secondary label">${e} :<br/><small>${i}</small></span>\n       </div>\n       <div class="buttonInfo">\n           <div class="inputBox">\n               <input pattern="${r}" type="${o}" class="numericInput" id='${n[c]}' placeholder=${t}>\n           </div>\n       </div>\n    </div>`};let Kt=new Set;const Qt=(e,t,n,i,s="buyer-settings-field",o=null)=>{const r=Object.keys(t)[0];return Kt.has(r)||($(document).on("click touchend",`#${t[r]}`,(e=>{!o&&((e,t,n)=>{const i=y(t)||{};i[e]?(i[e]=!1,$(n.currentTarget).removeClass("toggled")):(i[e]=!0,$(n.currentTarget).addClass("toggled")),h(t,i)})(r,i,e),o&&o(e)})),Kt.add(r)),`\n    <div class="price-filter  ${s}">\n        <div class="ut-toggle-cell-view">\n           <span class="ut-toggle-cell-view--label">${e} <br/><small>${n}</small></span>\n             <div id='${t[r]}' class="ut-toggle-control">\n               <div class="ut-toggle-control--track">\n              </div>\n              <div class= "ut-toggle-control--grip" >\n          </div> \n           </div> \n       </div>\n    </div> `},Zt=function(){const e=S();return`<div class='buyer-settings-wrapper buy-settings-view'>\n      ${Qt("Find Buy Price",{idBuyFutBinPrice:vt},`(Uses ${e} price for Buy)`,"BuyerSettings")}\n      ${Xt("Buy/Bid Price Percent",100,{idBuyFutBinPercent:wt},`(Buy/Bid Price percent of ${e} Price)`,"BuyerSettings")}\n      ${Qt(`Bid For ${e} Price`,{idAbBidFutBin:$t},`(Bid if the current bid is lesser than ${e} Price)`,"BuyerSettings")}\n      ${Xt("Buy Price","",{idAbBuyPrice:H},"<br/>","BuyerSettings")}\n      ${Xt("No. of cards to buy",1e3,{idAbCardCount:z},"(Works only with Buy price)","BuyerSettings")}\n      ${Xt("Bid Price","",{idAbMaxBid:j},"<br/>","BuyerSettings")}\n      ${Xt("Bid items expiring in","1H",{idAbItemExpiring:G},"(S for seconds, M for Minutes, H for hours)","BuyerSettings","text","\\d+[H|M|S|h|m|s]$")} \n      ${Xt("Search result threshold",21,{idAbSearchResult:J},"(Buy or bid cards only if the no.of search results is lesser than the specified value)","BuyerSettings")}\n      ${Qt("Bid Exact Price",{idAbBidExact:q},"","BuyerSettings")}      \n     </div>\n    `};$(document).on("keyup","#"+Y,(function({target:{value:e}}){en(e)}));const en=e=>{const t=parseInt(e);if(isNaN(t))return void $("#"+Ne).html(0);const n=(e-e/100*5).toLocaleString();$("#"+Ne).html(n)},tn=function(){const e=S();return`<div style='display : none' class='buyer-settings-wrapper sell-settings-view'>\n  ${Qt("Find Sale Price",{idSellFutBinPrice:it},`(Uses ${e} price for listing)`,"BuyerSettings")}\n  ${Xt("Sell Price Percent","100-100",{idSellFutBinPercent:st},`(Sale Price percent of ${e} Price)`,"BuyerSettings","text","\\d+-\\d+$")}\n  ${Qt("Check buy price before listing",{idSellCheckBuyPrice:ct},"(List only if Buy Price is lesser than Sale Price)","BuyerSettings")}\n  ${Xt("Sell Price","",{idAbSellPrice:Y},`(-1 to send to transferlist)<br />Receive After Tax: <span id=${Ne}>0</span>`,"BuyerSettings")} \n   ${Xt("List Duration","1H",{idFutBinDuration:ft},"List Duration when listing","BuyerSettings","text","\\d+[H|M|S|h|m|s]$")}\n  ${Xt("Clear sold count",10,{idAbMinDeleteCount:X},"(Clear sold items when reach a specified count)","BuyerSettings")}\n  ${Xt("Rating Threshold",100,{idSellRatingThreshold:nt},"(Rating threshold to list the sniped player)","BuyerSettings")}\n  ${Qt("Relist Unsold Items",{idAbSellToggle:K},"","BuyerSettings")}\n  ${Qt("Dont move won items",{idAbDontMoveWon:At},"(Keep won items in Unassigned or Transfer Targets)","BuyerSettings")}\n  </div>`},nn=function(){return`<div style='display : none' class='buyer-settings-wrapper safety-settings-view'>\n  ${Xt("Wait Time","7-15",{idAbWaitTime:Q},"(Random second range eg. 7-15)","CommonSettings","text","\\d+-\\d+$")}\n  ${Xt("Max purchases per search request",1,{idAbMaxPurchases:Lt},"Increase this, only if you are Adding Delay After Buy of alteast 3S","CommonSettings")}\n  ${Xt("Pause Cycle","10-15",{idAbCycleAmount:Z},"(No. of searches performed before triggering Pause eg. 10-15)","CommonSettings","text","\\d+-\\d+$")}\n  ${Xt("Pause For","5-8S",{idAbPauseFor:ee},"(S for seconds, M for Minutes, H for hours eg. 0-0S)","CommonSettings","text","\\d+-\\d+[H|M|S|h|m|s]$")}\n  ${Qt("Add Delay After Buy",{idAbAddBuyDelay:ce},"(Adds Delay after trying to buy / bid a card)","CommonSettings")}\n  ${Xt("Delay To Add","1S",{idAbDelayToAdd:de},"(S for seconds, M for Minutes, H for hours)","CommonSettings","text","\\d+[H|M|S|h|m|s]$")}\n  ${Xt("Stop After","3-4H",{idAbStopAfter:te},"(S for seconds, M for Minutes, H for hours  eg. 3-4H)","CommonSettings","text","\\d+-\\d+[H|M|S|h|m|s]$")}\n  ${Qt("Show Search Exceed Warning",{idAbOverSearchWarning:Ut},"(Shows a warning in log if number of search per minute exceeds 15)","CommonSettings")} \n  </div>`},sn=function(){return`<div style='display : none' class='buyer-settings-wrapper captcha-settings-view'>\n    ${Qt("Close Web App on Captcha Trigger",{idAbCloseTabToggle:pe},"","CommonSettings")}         \n    ${Qt("Auto Solve Captcha",{idAbSolveCaptcha:De},"","CommonSettings")}\n    ${Xt("Anti-Captcha Key","",{idAntiCaptchKey:Ze},"","CommonSettings","text")}\n    ${Xt("Proxy Address","",{idProxyAddress:Xe},"","CommonSettings","text")}\n    ${Xt("Proxy Port","",{idProxyPort:Ke},"","CommonSettings")}\n    ${Xt("Proxy User Name (Optional)","",{idProxyLogin:Qe},"","CommonSettings","text")}\n    ${Xt("Proxy User Password (Optional)","",{idProxyPassword:et},"","CommonSettings","text")} \n    `};let on=new Set;const rn=(e,t,n,i)=>(on.has(e)||(an(e,n),on.add(e)),`<button class="btn-standard ${i}" id="${e}">${t}</button>`),an=(e,t)=>{$(document).on({mouseenter:function(){$(this).addClass("hover")},mouseleave:function(){$(this).removeClass("hover")},click:function(){t()},touchenter:function(){$(this).addClass("hover")},touchleave:function(){$(this).removeClass("hover")},touchend:function(){t()}},`#${e}`)},ln=function(){return`<div style='display : none' class='buyer-settings-wrapper notification-settings-view'> \n ${l?"":`${Xt("Telegram Bot Token","",{idTelegramBotToken:he},"Token of your own bot","CommonSettings","text")}\n  ${Xt("Telegram Chat ID","",{idTelegramChatId:ye},"Your Telegram ChatID","CommonSettings","text")}\n  ${Xt("Discord Bot Token","",{idDiscordToken:we},"Your Discord Bot Token","CommonSettings","text")}\n  ${Xt("Discord Channel ID","",{idDiscordChannelId:Se},"Your Discord Channel ID","CommonSettings","text")}\n  ${Xt("Discord WebHook Url","",{idWebHookUrl:Et},"Your Discord Channel Webhook Url","CommonSettings","text")}\n  ${Xt("Fut Market Alert Notification Token","",{idFUTMarketAlertToken:$e},"Your FUT Market Alert App's Token","CommonSettings","text")}\n  ${Qt("Send Listing Notification",{idAbSendListingNotificationToggle:ge},"","CommonSettings")}`}\n  ${Xt("Notification Type","",{idNotificationType:ve},"Type A for all notifications, B for buy or L for lost","CommonSettings","text","[A|B|L]$")}\n  ${Qt("Send Notification",{idAbMessageNotificationToggle:me},"","CommonSettings")}\n   ${l?"":`${Qt("Sound Notification",{idAbSoundToggle:be},"","CommonSettings")}\n  <audio id='${qe}' hidden>\n    <source src="https://notificationsounds.com/storage/sounds/file-sounds-869-coins.ogg" type="audio/ogg">\n    <source src="https://notificationsounds.com/storage/sounds/file-sounds-869-coins.mp3" type="audio/mpeg">\n      "Your browser does not support the audio element"\n  </audio>\n  <audio id='${Ye}' hidden>\n    <source src="https://notificationsounds.com/storage/sounds/file-sounds-897-alarm-frenzy.ogg" type="audio/ogg">\n    <source src="https://notificationsounds.com/storage/sounds/file-sounds-897-alarm-frenzy.mp3" type="audio/mpeg">\n      "Your browser does not support the audio element"\n  </audio>\n  <audio id='${Rt}' hidden>\n    <source src="https://freesound.org/data/previews/220/220763_4104696-lq.ogg" type="audio/ogg">\n    <source src="https://freesound.org/data/previews/220/220763_4104696-lq.mp3" type="audio/mpeg">\n      "Your browser does not support the audio element"\n  </audio> `}\n     ${Qt("Use Custom Discord Webhook Name",{idAbCustomDiscordNameNotificationToggle:fe},"","CommonSettings")}\n   <div class="btn-test-notification buyer-settings-field">\n   ${rn(Ie,"Test Notification",(()=>Hn("Test Notification Message",!0,!0)),"call-to-action")}\n   </div>\n  `},cn=function(){return`<div style='display : none' class='buyer-settings-wrapper common-settings-view'>\n  ${Xt("Error Codes to stop bot (csv)","",{idAbStopErrorCode:je},"(Eg. 412,421,521)","CommonSettings","text","^\\d+(,\\d+)*$")}\n  ${Xt("No. of times error code should occur",3,{idAbStopErrorCodeCount:Je},"<br />","CommonSettings")}\n  ${Xt("Resume bot after","",{idAbResumeAfterErrorOccured:Ct},"(S for seconds, M for Minutes, H for hours eg. 0-0S)","CommonSettings","text","\\d+-\\d+[H|M|S|h|m|s]$")}\n  ${Qt("Auto Clear Log",{idAutoClearLog:tt},"(Automatically clear logs every 2 minutes)","CommonSettings")}\n  ${Qt("Auto Clear Expired Items",{idAutoClearExpired:ht},"(Automatically clear expired items from transfer targets)","CommonSettings")}\n  ${Qt("Use Futwiz Price",{idAbUseFutWiz:Wt},"(Uses Futwiz price for buying/selling cards)","CommonSettings")}\n  </div>`},dn=function(e,t){let n=!1;return $(`${e} option`).each((function(){if(this.value===t)return n=!0,!1})),n||$(e).append($("<option></option>").attr("value",t).text(t)),n},un=function(){const e=$(`#${V}`).val()||[];e.length?h("selectedFilters",e):h("selectedFilters",[])};let pn;$(document).on({change:()=>{const e=$(`#${Pt}`).val()||"buy",t=y("BuyerSettings")||{};t.idAbSortBy=e,h("BuyerSettings",t)}},`#${Pt}`);const mn=function(){const e=$(`<div style='display : none' class='buyer-settings-wrapper results-filter-view'>\n    <div class="place-holder">\n    </div>\n    ${Qt("Ignore/Buy Players List",{idAbIgnoreAllowToggle:yt},"(If toggled bot will only buy/bid the above players else bot will ignore the players when bidding/buying )","BuyerSettings")}\n    ${Xt("Min Rating",10,{idAbMinRating:ne},"Minimum Player Rating","BuyerSettings")}\n    ${Xt("Max Rating",100,{idAbMaxRating:ie},"Maximum Player Rating","BuyerSettings")}    \n    ${Xt("Search result page limit",5,{idAbMaxSearchPage:le},"No of. pages bot should move forward before going back to page 1","BuyerSettings")}\n    ${Xt("Max value of random min bid",300,{idAbRandMinBidInput:se},"","BuyerSettings")}\n    ${Qt("Use random min bid",{idAbRandMinBidToggle:ae},"","BuyerSettings")}\n    ${Xt("Max value of random min buy",300,{idAbRandMinBuyInput:oe},"","BuyerSettings")}\n    ${Qt("Use random min buy",{idAbRandMinBuyToggle:re},"","BuyerSettings")}\n    ${Qt("SKIP GK",{idAbAddFilterGK:ue},"(Skip all goalkeepers to buy / bid a card)","BuyerSettings")}\n    ${Qt("Sort players",{idAbShouldSort:_t},"","BuyerSettings")}\n    <div class="price-filter buyer-settings-field">\n      <div class="displayCenterFlx">\n      <select style="width:95%;height: 3rem;font-size: 1.5rem;" class="select-sortBy filter-header-settings" id="${Pt}">\n        <option disabled selected>--Select Sort Attribute--</option>\n        <option value="expires">Expires on</option>          \n        <option value="buy">Buy now price</option>\n        <option value="bid">Bid now price</option>\n        <option value="rating">Player rating</option>\n      </select>\n      </div>\n    </div>\n    ${Qt("Order",{idAbSortOrder:It},"(Enabled = descending, Disabled = ascending)","BuyerSettings")}\n  </div>`),t=e.find(".place-holder");return function(){pn=new UTPlayerSearchControl;const e=`#${mt}`,t=$(`\n            <div class="price-filter buyer-settings-field">\n              <div class="info">\n               <span class="secondary label">\n                  <button id=${Nt} style="font-size:16px" class="flat camel-case">Players List</button><br/>\n                </span>\n              </div>\n              <div class="ignore-players displayCenterFlx">\n                ${rn(ut,"+",(()=>{const t=`${pn._playerNameInput.value}(${pn.selected.rating})`,n=dn(e,t);if($(`${e} option[value="${t}"]`).attr("selected",!0),!n){const e=y("BuyerSettings")||{},n=e.idAddIgnorePlayersList||[];n.push({id:pn.selected.id,displayName:t}),e.idAddIgnorePlayersList=n,h("BuyerSettings",e)}}),"btn-standard filterSync action-icons")}                \n                </div>\n              </div>\n              <div class="price-filter buyer-settings-field">\n                <div class="info">\n                <span class="secondary label">\n                  <button id=${Nt} style="font-size:16px" class="flat camel-case">Remove from Players List</button><br/>\n                </span>\n                </div>\n                <div class="displayCenterFlx">\n                  <select style="width:90%;height: 3rem;font-size: 1.5rem;" class="filter-header-settings" id=${mt}>\n                    <option selected="true" disabled>Players List</option>                            \n                  </select>\n                  ${rn(pt,"❌",(()=>{const t=$(`${e} option`).filter(":selected").val();if("Ignored Players List"!=t){$(`${e} option[value="${t}"]`).remove(),$(`${e}`).prop("selectedIndex",0);const n=y("BuyerSettings")||{};let i=n.idAddIgnorePlayersList||[];i=i.filter((({displayName:e})=>e!=t)),n.idAddIgnorePlayersList=i,h("BuyerSettings",n)}}),"btn-standard filterSync font15 action-icons")}\n                </div>\n              </div>              \n              `);return $(pn.__root).insertBefore(t.find(`#${ut}`)),pn.init(),pn._playerNameInput.setPlaceholder("Search Players"),t}().insertAfter(t),e},fn=(e,t,n,i)=>{const s=new EADialogViewController({dialogOptions:e,message:n,title:t});s.init(),s.onExit.observe(void 0,(function(e,t){e.unobserve(this),i.call(this,t)})),gPopupClickShield.setActivePopup(s)};$(document).on({touchend:function(){$(`#${gt}`).trigger("click")}},`#${gt}`);const gn=e=>{const t={},n=$(`#${at}`).val()||[];if(n.length){for(let i of n){const n=e[i],s=JSON.parse(n);t[i]=s}var i,s;i={filters:t},s="filters",l?x(i,s):P(i,s),On("Filters downloaded successfully")}else On("No filter selected",UINotificationType.NEGATIVE)},bn=()=>{const e=$(`#${gt}`).prop("files");if(!e||!e[0])return void On("No filter file selected",UINotificationType.NEGATIVE);const t=e[0],n=new FileReader;n.onload=e=>{const t=JSON.parse(e.target.result);if(t&&t.filters){for(let e in t.filters)kn(e,t.filters[e]);On("Filters uploaded successfully")}else On("Not a valid filters file")},n.readAsText(t)},hn=async()=>{y("filters")||h("filters",await f()||{});let e=y("filters");return e=Object.keys(e).sort().reduce(((t,n)=>(t[n]=e[n],t)),{}),e};$(document).on({change:un,click:un,touchend:un},`#${V}`);const yn=(e,t)=>{let n=y(t);return n?(n=!1,$(e.currentTarget).removeClass("toggled")):(n=!0,$(e.currentTarget).addClass("toggled")),h(t,n),n},vn=async function(){return y("runSequentially")&&(h("runSequentially",!1),setTimeout((()=>{$(`#${dt}`).click()}))),`<div style='display : none' class='buyer-settings-wrapper filter-settings-view'>\n                <div class="price-filter buyer-settings-field multiple-filter teleporter">\n                    <select  multiple="multiple" class="multiselect-filter filter-header-settings" id="${V}"\n                     name="selectedFilters" style="overflow-y : scroll;">\n                     ${Object.keys(await hn()).map((e=>`<option value='${e}'>${e}</option>`))}\n                    </select>\n                </div>\n                ${Xt("No. of search For each filter",y("fiterSearchCount")||3,{idAbNumberFilterSearch:ze},"(Count of searches performed before switching to another filter)","CommonSettings","number",null,"buyer-settings-field",(e=>h("fiterSearchCount",parseInt(e)||3)))}\n                ${Qt("Switch filter sequentially",{idRunFilterSequential:dt},"","CommonSettings","buyer-settings-field",(e=>yn(e,"runSequentially")))}\n            </div>\n    `},wn=async function(e){const t=this,n=e?"transfer":"";$(document).off("change",`#${W}${n}`),$(document).on({change:function(){const i=$(`#${W}${n} option`).filter(":selected").val();Un.call(t,i,e)}},`#${W}${n}`);const i=$(`<div style="width:100%;display: flex;flex-direction: column;">\n            ${isPhone()&&!e?Qt("Runner Mode",{idAbToggleRunner:St},"","MisSettings","runner",(e=>{const t=yn(e,"runnerToggle");$(".auto-buyer").toggleClass("displayNone"),t?$(".filter-place").append($(`#${V}`)):$(".teleporter").append($(`#${V}`))})):""}\n            ${e?"":`<div id=${Dt} class="btn-report"></div>`}         \n            <div class="price-filter buyer-settings-field multiple-filter filter-place">\n            </div> \n            <div class="button-container btn-filters">\n                 <select class="filter-header-settings" id='${W}${n}'>\n                    <option selected="true" disabled>Choose filter to load</option>\n                    ${e?"":'<option value="_default">_DEFAULT</option>'}  \n                    ${Object.keys(await hn()).map((e=>`<option value="${e}">${e}</option>`))}                    \n                 </select>                 \n                ${e?"":rn(ot,"⇧",(()=>{(()=>{let e=`Upload Filter Json file <br /> <br />\n  <input accept=".json" type="file" id="${gt}">\n   </input> <br /> <br /> <br />\n   Uploading filters will override filters with the same name`;fn([{labelEnum:enums.UIDialogOptions.OK},{labelEnum:enums.UIDialogOptions.CANCEL}],"Upload filters",e,(e=>{2===e&&bn()}))})()}),"filterSync")}\n               ${e?"":rn(rt,"⇩",(()=>{(()=>{const e=y("filters");let t=`Choose filters to Download <br /> <br />\n  <select  multiple="multiple" class="multiselect-filter filter-header-settings" id="${at}"\n      style="overflow-y : scroll">\n      ${Object.keys(e).map((e=>`<option value='${e}'>${e}</option>`))}\n   </select> <br /> <br /> <br />`;fn([{labelEnum:enums.UIDialogOptions.OK},{labelEnum:enums.UIDialogOptions.CANCEL}],"Download filters",t,(async t=>{2===t&&await gn(e)}))})()}),"filterSync")}\n             </div> \n               ${e?"":`<div id=${Mt} style="margin-top: 1%;" class="button-container btn-filters"></div>`}\n             </div>`);return!e&&Sn.call(this,i,t),i},Sn=function(e,t){const n=e.find(`#${Mt}`),i=e.find(`#${Dt}`);n.append(Jt("Delete Filter",(()=>Ln.call(t)),"call-to-action btn-delete-filter").__root),n.append(Jt("Save Filter",(function(){Rn.call(this,t)}),"call-to-action btn-save-filter").__root),i.append(Jt("Report a problem",(()=>{fn([{labelEnum:atob("RGlzY29yZA==")},{labelEnum:atob("VHdpdHRlcg==")},{labelEnum:atob("R2l0aHVi")}],atob("UmVwb3J0IGEgcHJvYmxlbQ=="),atob("QmVsb3cgYXJlIHRoZSBsaXN0IG9mIHdheXMgdG8gcmVwb3J0IGEgcHJvYmxlbSA8YnIgLz5NYWtlIHN1cmUgdG8gZ28gdGhyb3VnaCB0aGUgPGEgaHJlZj0naHR0cHM6Ly95b3V0dWJlLmNvbS9wbGF5bGlzdD9saXN0PVBMR21LTWczYVJrWGpQUjVna2x4TXlxeHRoWW9vV0k1SUMnIHRhcmdldD0nX2JsYW5rJz55b3V0dWJlIHBsYXlsaXN0PC9hPiBpZiBhbnkgc2V0dGluZ3MgYXJlIHVuY2xlYXIgPGJyIC8+"),(e=>{e===atob("R2l0aHVi")?window.open(atob("aHR0cHM6Ly9naXRodWIuY29tL2NoaXRoYWt1bWFyMTMvRlVULUF1dG8tQnV5ZXIvaXNzdWVz"),atob("X2JsYW5r")):e===atob("RGlzY29yZA==")?window.open(atob("aHR0cHM6Ly9kaXNjb3JkLmNvbS9pbnZpdGUvY2t0SFltcA=="),atob("X2JsYW5r")):e===atob("VHdpdHRlcg==")&&window.open(atob("aHR0cHM6Ly90d2l0dGVyLmNvbS9BbGdvc0Nr"),atob("X2JsYW5r"))}))}),"call-to-action").__root)},$n=new Map;let An,Cn;$n.set(0,{label:"Buy/Bid Settings",selector:".buy-settings-view"}),$n.set(1,{label:"Sell Settings",selector:".sell-settings-view"}),$n.set(2,{label:"Search Settings",selector:".results-filter-view"}),$n.set(3,{label:"Safety Settings",selector:".safety-settings-view"}),$n.set(4,{label:"Filter Settings",selector:".filter-settings-view"}),$n.set(5,{label:"Captcha Settings",selector:".captcha-settings-view"}),$n.set(6,{label:"Notification Settings",selector:".notification-settings-view"}),$n.set(7,{label:"Common Settings",selector:".common-settings-view"});const Tn=function(){return Cn=new EAFilterBarView,$n.forEach(((e,t)=>{Cn.addTab(t,e.label)})),Cn.setActiveTab(0),Cn.layoutSubviews(),Cn.addTarget(this,_n,EventType.TAP),Cn.__root.style="margin-top: 20px;",An=$(Cn.__root),An.find(".menu-container").css("overflow-x","auto"),Pn(!0),Cn},xn=async function(){In(),Dn(),await Pn();const e=y("AutoBuyerInstance");UTMarketSearchFiltersViewController.prototype._eResetSelected.call(e)},Bn=async e=>{let t=await f("CommonSettings");if(t=JSON.parse(t.CommonSettings||"{}"),!$.isEmptyObject(t)){const n=e?y("CommonSettings"):{};h("CommonSettings",Object.assign({},n,t))}},Pn=async function(e){Cn.setActiveTab(0),An.append(Zt.call(this)),An.append(tn.call(this)),An.append(mn.call(this)),An.append(nn.call(this));const t=await vn.call(this);An.append(t),An.append(sn.call(this)),An.append(ln.call(this)),An.append(cn.call(this)),$(".menu-container").animate({scrollLeft:0}),setTimeout((async()=>{const t=y("selectedFilters")||[],{idAbSortBy:n}=y("BuyerSettings")||{};n&&$(`${Pt} option[value='${n}']`).prop("selected","selected"),$.each(t,(function(e,t){$(".multiselect-filter option[value='"+t+"']").prop("selected","selected")})),e&&await Bn()}))},In=()=>{$n.forEach(((e,t)=>{$(e.selector).remove()})),pn.destroy(),pn=null},_n=function(e,t,n){Mn();const i=$n.get(n.index).selector;$(i).css("display","")},Mn=()=>{$n.forEach(((e,t)=>{$(e.selector).css("display","none")}))},Dn=()=>{h("currentFilter",null),h("BuyerSettings",{}),h("currentFilter",{})},Nn=()=>{document.querySelectorAll(":invalid").length&&On("Settings with invalid value found, fix these values for autobuyer to work as intended",UINotificationType.NEGATIVE)},Fn=`#${W}`,En=`#${V}`,Rn=function(e){const t=this;$(t).addClass("active");let n=v(!0),i=y("CommonSettings");setTimeout((function(){let s={};const o=e._viewmodel;s.searchCriteria={criteria:o.searchCriteria,playerData:o.playerData,buyerSettings:n};let r=$(`${Fn} option`).filter(":selected").val();"Choose filter to load"===r&&(r=void 0);let a=prompt("Enter a name for this filter",r);if(Nn(),a){if("_DEFAULT"===a.toLocaleUpperCase())return On("Cannot override _DEFAULT filter",UINotificationType.NEGATIVE);kn(a,s),g("CommonSettings",JSON.stringify(i),"CommonSettings"),h("currentFilter",a),$(t).removeClass("active"),On("Changes saved successfully")}else $(t).removeClass("active"),On("Filter Name Required",UINotificationType.NEGATIVE)}),200)},kn=(e,t)=>{e=e.toUpperCase(),dn(Fn,e),dn(`#${V}`,e),$(`${Fn} option[value="${e}"]`).attr("selected",!0),y("filters")[e]=JSON.stringify(t),g(e,y("filters")[e])},Un=async function(e,t){if("_default"===e)return(()=>{h("BuyerSettings",Object.assign({},r)),h("CommonSettings",Object.assign({},a));const e=v();L(e)})(),!1;y("runnerToggle")||t||await xn();const n=y("filters")[e];if(!n)return!1;let{searchCriteria:{criteria:i,playerData:s,buyerSettings:o}}=JSON.parse(n);if(this.viewmodel.resetSearch(),this.viewDidAppear(),this.viewmodel.playerData={},Object.assign(this.viewmodel.searchCriteria,i),Object.assign(this.viewmodel.playerData,s),$.isEmptyObject(this.viewmodel.playerData)&&(this.viewmodel.playerData=null),this.viewDidAppear(),t)return;await Bn();const l=y("CommonSettings")||{};if(h("BuyerSettings",o),h("currentFilter",e),o=Object.assign({},o,l),L(o),o.idAddIgnorePlayersList&&o.idAddIgnorePlayersList.length)for(let{displayName:e}of o.idAddIgnorePlayersList)dn(`#${mt}`,e);return Nn(),!0},Ln=async function(){const e=$(`${Fn} option`).filter(":selected").val();if("_DEFAULT"===e.toLocaleUpperCase())return On("Cannot delete _DEFAULT filter",UINotificationType.NEGATIVE);"Choose filter to load"!=e&&($(`${Fn} option[value="${e}"]`).remove(),$(`${Fn}`).prop("selectedIndex",0),await xn(),this.viewDidAppear(),delete y("filters")[e],$(`${En} option[value="${e}"]`).remove(),un(),(e=>{u(e)})(e),On("Changes saved successfully"))};let Wn=null;const On=function(e,t){t=t||UINotificationType.POSITIVE,services.Notification.queue([e,t])},Vn=e=>{services.PIN.sendData(PINEventType.PAGE_VIEW,{type:PIN_PAGEVIEW_EVT_TYPE,pgid:e})},Hn=(e,t,n)=>{const i=v();(i.idAbMessageNotificationToggle||n)&&(l?zn(e):Gn(i,t,e),n&&On("Test Notification Sent"))},zn=e=>{window.ReactNativeWebView.postMessage(JSON.stringify({type:"Notification",message:e}))},jn=(e,t,n)=>{let i={embeds:[{description:e,color:t?2555648:16711680,footer:{text:`Auto Buyer Alert - ${(new Date).toLocaleTimeString()}`,icon_url:"https://cdn.discordapp.com/icons/768336764447621122/9de9ea0a7c6239e2f2fbfbd716189e79.webp"}}],avatar_url:"https://cdn.discordapp.com/icons/768336764447621122/9de9ea0a7c6239e2f2fbfbd716189e79.webp",username:"Fut Market Alert"};return n&&delete i.username,i},Jn=e=>{const{embeds:[t]}=e;return(new Discord.RichEmbed).setColor(t.color).setDescription(t.description).setFooter(t.footer.text,t.footer.icon_url)},Gn=(e,t,n)=>{const i=e.idTelegramBotToken,s=e.idTelegramChatId,o=e.idWebHookUrl,r=e.idDiscordChannelId,a=e.idFUTMarketAlertToken,l=e.idAbCustomDiscordNameNotificationToggle;qn(i,s,n),Xn(r,t,n,l),Yn(o,t,n,l),Qn(a,n)},qn=(e,t,n)=>{if(e&&t){const i=`https://api.telegram.org/bot${e}/sendMessage?chat_id=${t}&parse_mode=Markdown&text=${n}`,s=new XMLHttpRequest;s.open("GET",i,!0),s.send()}},Yn=(e,t,n,i)=>{e&&fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(jn(n,t,i))})},Xn=(e,t,n,i)=>{if(e)if(Wn){const s=Wn.channels.get(e);s&&s.send(Jn(jn(n,t,i)))}else Wn=Kn((()=>{setTimeout((()=>{if(Wn){const s=Wn.channels.get(e);s&&s.send(Jn(jn(n,t,i)))}}),200)}))},Kn=e=>{const t=v(),n=new Discord.Client;let i=t.idDiscordToken;if(!i)return null;try{n.login(i),n.on("ready",(function(){e&&e()})),n.on("message",(async function(e){if(e.author.id!=n.user.id)if(/start/i.test(e.content)){const t=y("AutoBuyerInstance");Hi.call(t),e.channel.send(Jn(jn("Bot started successfully",!0)))}else if(/stop/i.test(e.content))zi(),e.channel.send(Jn(jn("Bot stopped successfully",!0)));else if(/runfilter/i.test(e.content)){let t=e.content.split("-")[1];if(t){t=t.toUpperCase(),zi(),h("selectedFilters",[]);const n=y("AutoBuyerInstance");if(!await Un.call(n,t))return void e.channel.send(Jn(jn(`unable to find filter${t}`,!1)));Hi.call(n),e.channel.send(Jn(jn(`${t} started successfully`,!0)))}else e.channel.send(Jn(jn("Unable to find filter name",!1)))}}))}catch(e){}return n},Qn=(e,t)=>{e&&fetch("https://exp.host/--/api/v2/push/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify([{to:`ExponentPushToken[${e}]`,title:t,body:t}])})},Zn=function(e){Hn("Captcha, please solve the problem so that the bot can work again.",!1),e?window.location.href="about:blank":ei("[!!!] Autostopping bot since Captcha got triggered",Ae)},ei=function(e,t,n,i){setTimeout((()=>{var s=$("#"+t);const o=$(`\n              <li class="cardPalyerLi">\n              <div class="cardPalyer" style="${"success"===i?"border: solid #10AC84;":"error"===i?"border: solid #EE5253;":"warning"===i?"border: solid #FF9F43;":"border: solid #2E86DE;"}">\n              ${n?`<img\n                  style="width:30%; padding-left: 15px;"\n                  src="https://www.ea.com/ea-sports-fc/ultimate-team/web-app/content/24B23FDE-7835-41C2-87A2-F453DFDB2E82/2024/fut/items/images/mobile/portraits/${n?._metaData?.id}.png"\n                />`:""}\n              \n              <div class="container">\n                <span class="contentContainer" >${e}</span>\n                <div class="typeContent" style="${"success"===i?"background: #10AC84;":"error"===i?"background: #EE5253;":"warning"===i?"background: #FF9F43;":"background: #2E86DE;"}">\n                  <span class="typeContentText">${"success"===i?"✓":"error"===i?"X":"warning"===i?"!":"↻"}</span>\n                </div>\n              </div>\n              </div>\n              </li>\n          `);s.append(o),s[0]&&s.scrollTop(s[0].scrollHeight)}),50)},ti=()=>{$("#"+Ae).val(""),Gt()};setInterval((()=>{const e=v();e&&e.idAutoClearLog&&ti()}),12e4);const ni=()=>{let e=y("userPlatform");return e||(services.User.getUser().getSelectedPersona().isPC?(h("userPlatform","pc"),"pc"):(h("userPlatform","ps"),"ps"))},ii=()=>new Promise((e=>{services.User.requestCurrencies().observe(void 0,(function(t,n){e()}))}));let si,oi;const ri=function(e){if(!y("autoBuyerActive"))return;const t=1e3*_(e.idAbPauseFor);oi=oi||M(e.idAbCycleAmount);const{searchCount:n,previousPause:i}=y("sessionStats");return!n||(n-i)%oi?void 0:(zt("previousPause",n),ii(),zi(!0),setTimeout((()=>{oi=M(e.idAbCycleAmount),Hi.call(this,!0)}),t))},ai=async function(){const e=y("selectedFilters"),t=y("fiterSearchCount"),n=y("currentFilterCount");if(!e||!e.length||t>n)return w("currentFilterCount"),!1;h("currentFilterCount",1),h("currentPage",1);const i=y("currentFilterIndex")||0;let s=y("runSequentially")?i%e.length:F(0,e.length-1);h("currentFilterIndex",s+1);let o=e[s];return await Un.call(this,o),ei(`Running for filter ${o}`,Ae),!0},li=async e=>{l?ci(e):di(e)},ci=e=>{h(e.identifier,e.onload),delete e.onload,window.ReactNativeWebView.postMessage(JSON.stringify({type:"fetchFromExternalAB",payload:{options:e}}))},di=e=>{GM_xmlhttpRequest({method:e.method,url:e.url,onload:e.onload,headers:{"User-Agent":Ft}})},ui=(e,t,n)=>new Promise(((i,s)=>{li({method:t,identifier:n,url:e,onload:e=>200!==e.status?s():i(e.response)})})),pi=async(e,t)=>{try{const n=await mi(e),i=ni();if(!n)return;const s=await ui(`https://www.futwiz.com/en/app/sold23/${n[0].lineid}/console`,"GET",`${e.definitionId}_fetchFutWizPlayerPrices`),o=JSON.parse(s);let r=o.prices[i].bin;"ps"!==i||r||(r=o.prices.xb.bin);const a=parseInt(r.replace(/[,.]/g,"")),l=`${e.definitionId}_futwiz_price`,c={expiryTimeStamp:new Date(Date.now()+9e5),price:a};h(l,c),t.set(l,a)}catch(e){console.log(e)}},mi=e=>new Promise(((t,n)=>{const i=TextUtils.stripSpecialCharacters("---"!==e._staticData.knownAs?e._staticData.knownAs:e._staticData.name);li({url:`https://www.futwiz.com/en/searches/player23/${i}`,method:"GET",identifier:`${e.definitionId}_getFutWizPlayerUrl`,onload:n=>{if(200!==n.status)return t();const i=JSON.parse(n.response);if(!i)return t();let s=i.filter((t=>parseInt(t.rating)===e.rating));i&&!s.length&&(s=i),s&&s.length>1&&(s=s.filter((t=>t.rare===e.rareflag.toString()&&t.club===e.teamId+""))),t(s)}})})),fi=async e=>{const t=new Map,n=new Map;let i=[];for(const i of e){if(!i.definitionId)continue;const e=y(`${i.definitionId}_futwiz_price`);e?t.set(`${i.definitionId}_futwiz_price`,e.price):i.isPlayer()&&n.set(i.definitionId,i)}if(n.size)for(const e of n.values())i.push(pi(e,t));return await Promise.all(i),t},gi=e=>{const t=services.Localization;return t?e.isManagerContract()?t.localize("card.title.managercontracts"):e.isPlayerContract()?t.localize("card.title.playercontracts"):e.isStyleModifier()?UTLocalizationUtil.playStyleIdToName(e.subtype,t):e.isPlayerPositionModifier()?t.localize("card.desc.training.pos."+e._staticData.trainPosFrom+"_"+e._staticData.trainPosTo).replace(" >> ","->"):e._staticData.name:""},bi=new Set(["Position","Chemistry Style"]),hi=async(e,t)=>{const n=Array.from(e),i=ni();for(;n.length;){const e=n.splice(0,30),s=e.shift();if(!s)continue;const o=e.join(",");try{const n=await ui(`https://www.futbin.com/24/playerPrices?player=${s}&rids=${o}`,"GET",`${Math.floor(+new Date)}_fetchPlayerPrices`),r=JSON.parse(n);for(const n of[s,...e]){const e=r[n].prices[i].LCPrice;if(!e)continue;const s=parseInt(e.replace(/[,.]/g,"")),o=`${n}_futbin_price`,a={expiryTimeStamp:new Date(Date.now()+9e5),price:s};h(o,a),t.set(o,s)}}catch(e){console.log(e)}}},yi=async(e,t)=>{const n=ni(),i="ps"===n?"PS":"xbox"===n?"XB":"PC",s=Array.from(e.keys());for(const n of s)try{const s=n.split(" ")[0],o=await ui(`https://www.futbin.org/futbin/api/fetchConsumables?category=${s}&platformtype=${i}`,"GET",`${Math.floor(+new Date)}_fetchConsumablesPrices`),r=JSON.parse(o).data.reduce(((e,t)=>(e.set(t.SubType.toUpperCase(),t.LCPrice),e)),new Map),a=e.get(n)||[];for(const{definitionId:e,subType:n}of a){let i=r.get(n);const s=`${e}_futbin_price`;if(i){const e={expiryTimeStamp:new Date(Date.now()+9e5),price:i};h(s,e),t.set(s,i)}}}catch(e){console.log(e)}},vi=async e=>{const t=new Map,n=new Set,i=new Map;for(const s of e){if(!s.definitionId)continue;const e=y(`${s.definitionId}_futbin_price`);e?t.set(`${s.definitionId}_futbin_price`,e.price):s.isPlayer()?n.add(s.definitionId):s.isTraining()&&bi.has(s._staticData.name)&&(i.has(s._staticData.name)||i.set(s._staticData.name,[]),i.get(s._staticData.name).push({definitionId:s.definitionId,subType:gi(s)}))}const s=[];return n.size&&s.push(hi(n,t)),i.size&&s.push(yi(i,t)),await Promise.all(s),t},wi=async e=>{const t=S();return"FUTWIZ"===t?fi(e):"FUTBIN"===t?vi(e):void 0},Si=e=>{let t=JSUtils.find(UTCurrencyInputControl.PRICE_TIERS,(function(t){return e>=t.min}));var n=Math.round(e/t.inc)*t.inc;return Math.max(Math.min(n,14999e3),0)},$i=e=>e<=1e3?e-50:e>1e3&&e<=1e4?e-100:e>1e4&&e<=5e4?e-250:e>5e4&&e<=1e5?e-500:e-1e3,Ai=e=>e<1e3?e+50:e>=1e3&&e<1e4?e+100:e>=1e4&&e<5e4?e+250:e>=5e4&&e<1e5?e+500:e+1e3,Ci=async(e,t,n)=>{let i;try{const s=n.definitionId,o=S();if("player"!==n.type)return i;await wi([n]);const r=y(`${s}_${o.toLowerCase()}_price`);if(r&&r.price){i=r.price;const s=M(e.idSellFutBinPercent)||100;let a=i*s/100;await Ti(n),n.hasPriceLimits()&&(a=Si(Math.min(n._itemPriceLimits.maximum,Math.max(n._itemPriceLimits.minimum,a))),a===n._itemPriceLimits.minimum&&(a=Ai(a))),a=Si(a),ei(`= ${o} price for ${t}: ${i}: ${s}% of sale price: ${a}`,Ae),i=a}else i=null,ei(`= Unable to get ${o} price for ${t}`,Ae)}catch(e){e=e.statusText||e.status||e,i=null,ei(`= Unable to get Futbin price for ${t}, err: ${e||"error occured"}`,Ae)}return i},Ti=async e=>new Promise((t=>{e.hasPriceLimits()?t():services.Item.requestMarketData(e).observe(void 0,(async function(e,n){t()}))})),xi=e=>{const t=y("sessionStats");t.transactions=t.transactions||[],t.transactions.push(e),h("sessionStats",t)},Bi=()=>{const{coinsNumber:e,searchCount:t,profit:n,runningTime:i,transactions:s}=y("sessionStats");let o="Available Coins,Search Count,Profit,Running Time,BIN Won Count,BID Won Count,Loss Count\n";o+=`${e||""},${t||""},${n||0},${i||""},${y("winCount")||0},${y("bidCount")||0},${y("lossCount")||0}\n\n`,o+="Transactions\n",o+=s.map((e=>`${e}\n`)).join(""),((e,t)=>{l?B(e,t):I(e,t)})(o,"Stats")};setInterval((()=>{const e=y("sessionStats");e.searchPerMinuteCount=0,h("sessionStats",e)}),55e3);const Pi=new Map,Ii=(e,t,n,i,s,r)=>{const a=v();return new Promise((l=>{services.Item.bid(e,n).observe(void 0,(async function(c,d){let u=R(n.toString(),6);const p=a.idNotificationType;if(d.success){s&&(w("purchasedCardCount"),k("cardWon"));const o=a.idSellRatingThreshold;let l=parseInt(e.rating);const c=!o||l<=o,d=a.idSellFutBinPrice;c&&d&&s&&(i=await Ci(a,t,e));a.idSellCheckBuyPrice&&n>95*i/100&&(i=-1);const m=i&&!isNaN(i)&&c,f=.95*i-n;if(s){const s=w("winCount");if(xi(`[${(new Date).toLocaleTimeString()}] ${t.trim()} achat avec succès - Prix : ${n}`),zt("winCount",s),ei(`<h2>${t}</h2> <br>Acheté à ${n} <br>Vendu à ${i} <br>Bénéfice de ${f}`,Ae,e,"success"),!a.idAbDontMoveWon){const n=y("sellQueue")||[];n.push({player:e,playerName:t,sellPrice:i,shouldList:m,profit:f}),h("sellQueue",n)}}else{const i=w("bidCount");xi(`${t.trim()} succès de l'enchère - Prix : ${n}`),ei(`B:${i} ${t} succès de l'enchère`,Ae,e,"success");const s=y("currentFilter")||"default";if(s){const e=y("filterBidItems")||new Map;e.has(s)?e.get(s).add(r):e.set(s,new Set([r])),h("filterBidItems",e)}}"B"!==p&&"A"!==p||Hn("| "+t.trim()+" | "+u.trim()+` | ${s?"buy":"bid"} |`,!0)}else{w("lossCount");xi(`[${(new Date).toLocaleTimeString()}] ${t.trim()} buy failed - Price : ${n}`);let i=(d.error&&d.error.code||d.status)+"";if(ei(`${t} - échec de l'${s?"achat":"enchère"} - ERR: (${o[i]+"("+i+")"||0})`,Ae,e,"error"),"L"!==p&&"A"!==p||Hn("| "+t.trim()+" | "+u.trim()+" | failure |",!1),a.idAbStopErrorCode){const t=new Set(a.idAbStopErrorCode.split(","));if(Pi.has(i)||Pi.set(i,{currentVal:0}),Pi.get(i).currentVal++,t.has(i)&&Pi.get(i).currentVal>=a.idAbStopErrorCodeCount&&(ei(`[!!!] Autostopping bot since error code ${i} has occured ${Pi.get(i).currentVal} times\n`,Ae,e,"error"),Pi.clear(),zi(),a.idAbResumeAfterErrorOccured)){const t=_(a.idAbResumeAfterErrorOccured);ei(`Le bot reprendra dans ${t}(s)`,Ae,e,"error"),setTimeout((()=>{Hi.call(y("AutoBuyerInstance"))}),1e3*t)}}}a.idAbAddBuyDelay&&await T(N(a.idAbDelayToAdd)),l()}))}))},_i=new Set,Mi=function(e){return Vn("Transfer Targets - List View"),new Promise((t=>{services.Item.clearTransferMarketCache(),services.Item.requestWatchedItems().observe(this,(function(n,i){let s=e.idAbMaxBid,o=e.idAbSellPrice,r=i.response.items.filter((function(e){return!!e._auction}));if(!r.length)return t();services.Item.refreshAuctions(r).observe(this,(function(n,i){services.Item.requestWatchedItems().observe(this,(async function(n,i){const r=y("autoBuyerActive"),a=y("currentFilter")||"default",l=(y("filterBidItems")||new Map).get(a)||new Set,c=y("userWatchItems");if(r&&s){let t=i.response.items.filter((function(e){return"outbid"===e._auction._bidState&&(!a||l.has(e._auction.tradeId))&&!c.has(e._auction.tradeId)&&"active"===e._auction._tradeState}));if(t.length){const n=t[F(0,t.length-1)];await Di(n,s,o,e)}}const d=e.idSellFutBinPrice;if(r&&!e.idAbDontMoveWon&&(o&&!isNaN(o)||d)){let t=i.response.items.filter((function(e){return e.getAuctionData().isWon()&&(!a||l.has(e._auction.tradeId))&&!c.has(e._auction.tradeId)&&!_i.has(e._auction.tradeId)}));for(var u=0;u<t.length;u++){const n=t[u],i=e.idSellRatingThreshold;let s=parseInt(n.rating);const r=!i||s<=i;let a=R(n._staticData.name,15),l=n._auction.currentBid;r&&d&&(o=await Ci(e,a,n));e.idSellCheckBuyPrice&&l>95*o/100&&(o=-1);const c=o&&!isNaN(o)&&r;if(c&&_i.add(n._auction.tradeId),!e.idAbDontMoveWon){const e=y("sellQueue")||[],t=.95*o-l;e.push({player:n,sellPrice:o,playerName:a,shouldList:c,profit:t}),h("sellQueue",e)}}}let p=i.response.items.filter((e=>{var t=e.getAuctionData();return t.isExpired()||t.isClosedTrade()&&!t.isWon()}));e.idAutoClearExpired&&p.length&&(services.Item.untarget(p),ei(`${p.length} élément(s) expirés et supprimés de la liste d'objectifs`,Ae)),services.Item.clearTransferMarketCache(),t()}))}))}))}))},Di=async(e,t,n,i)=>{let s=e._auction,o=s.currentBid,r=s.currentBid||s.startingBid,a=R(e._staticData.name,15);const l=y("autoBuyerActive");let c=i.idAbBidExact?t:o?$i(t):t,d=i.idAbBidExact?t:o?Ai(r):r;l&&r<=c&&(ei("Enchèr sur un élement en surenchère -> Prix d'enchère :"+d,Ae),await Ii(e,a,d,n),i.idAbAddBuyDelay&&await T(1))},Ni=()=>{const e=v();let t=e.idAntiCaptchKey,n=e.idProxyAddress,i=e.idProxyPort,s=e.idProxyLogin,o=e.idProxyPassword;if(!n||!i||!t)return ei("Proxy info not filled properly",Ae),void Zn(e.idAbCloseTabToggle);function r(e){let n={clientKey:t,taskId:e};var i=new XMLHttpRequest;i.open("POST","https://api.anti-captcha.com/getTaskResult",!0),i.setRequestHeader("Content-Type","application/json"),i.onreadystatechange=function(){if(4===i.readyState&&200===i.status){var t=JSON.parse(i.responseText);if(0==t.errorId)if("ready"==t.status){new UTCaptchaViewModel(accessobjects.Captcha).validateToken(t.solution.token).observe(this,(function(e,t){if(t.success){ei("Captcha Solved",Ae);const e=y("AutoBuyerInstance");Hi.call(e)}}))}else setTimeout((()=>r(e)),1e3);else ei("Error occured when checking captcha result : "+t.errorCode+", "+t.errorDescription,Ae)}};var s=JSON.stringify(n);i.send(s)}!function(){accessobjects.Captcha.getCaptchaData().observe(this,(function(e,a){if(a.success){if(!(c=a.response.blob))return!1;let e={clientKey:t,task:{type:"FunCaptchaTask",websiteURL:"https://www.ea.com/ea-sports-fc/ultimate-team/web-app/",websitePublicKey:"A4EECF77-AC87-8C8D-5754-BF882F72063B",funcaptchaApiJSSubdomain:"ea-api.arkoselabs.com",data:a.response,proxyType:"http",proxyAddress:n,proxyPort:i,proxyLogin:s,proxyPassword:o,userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.116 Safari/537.36"}};var l=new XMLHttpRequest;l.open("POST","https://api.anti-captcha.com/createTask",!0),l.setRequestHeader("Content-Type","application/json"),l.onreadystatechange=function(){if(4===l.readyState&&200===l.status){var e=JSON.parse(l.responseText);0==e.errorId?r(e.taskId):ei("Got error from Captcha API: "+e.errorCode+", "+e.errorDescription,Ae)}};var c=JSON.stringify(e);return l.send(c),!0}}))}()},Fi=new Set,Ei=function(e){return new Promise((t=>{const n=N(e.idAbItemExpiring),i=e.idAbRandMinBidToggle,s=e.idAbRandMinBuyToggle,o=e.idBuyFutBinPercent||100;let r=y("currentPage")||1;jt("searchPerMinuteCount")>15&&(e.idAbOverSearchWarning||void 0===e.idAbOverSearchWarning)&&ei("<h2>Attention !</h2> <br>Plus de 15 recherches effectuées en une minute, vous devez augmenter votre temps d'attente entre les recherches !",Ae,null,"warning");const a=new Set((e.idAddIgnorePlayersList||[]).map((({id:e})=>e))),l=S();let c=e.idAbMaxBid,d=e.idAbBuyPrice,u=e.idBuyFutBinPrice||e.idAbBidFutBin;if(!d&&!c&&!u)return ei("skip search >>> (No Buy or Bid Price given)",Ae),t();Vn("Transfer Market Search"),(()=>{const e=y("sessionStats");e.searchCount++,e.searchPerMinuteCount++,h("sessionStats",e)})();let p=this.viewmodel.searchCriteria;i&&(p.minBid=Si(F(0,e.idAbRandMinBidInput))),s&&(p.minBuy=Si(F(0,e.idAbRandMinBuyInput))),services.Item.clearTransferMarketCache(),services.Item.searchTransferMarket(p,r).observe(this,(async function(i,s){if(s.success){h("searchFailedCount",0);let t=!0;ei(`<h2>Aucun élément trouvé !</h2> <br>Page n°${r} <br>Enchère min à ${p.minBid} <br>Achat immédiat min à ${p.minBuy}`,Ae),s.data.items.length>0&&(1===r&&Vn("Transfer Market Results - List View"),u&&"player"===s.data.items[0].type&&await wi(s.data.items)),s.data.items.length>e.idAbSearchResult&&(t=!1);let i=e.idAbMaxPurchases||1;e.idAbShouldSort&&(s.data.items=((e,t,n)=>{let i=e=>e._auction.buyNowPrice;return"bid"===t?i=e=>e._auction.currentBid||e._auction.startingBid:"rating"===t?i=e=>parseInt(e.rating):"expires"===t&&(i=e=>parseInt(e._auction.expires)),e.sort(((e,t)=>{const s=i(e),o=i(t);return n?s-o:o-s})),e})(s.data.items,e.idAbSortBy||"buy",e.idAbSortOrder));for(let r=s.data.items.length-1;r>=0&&y("autoBuyerActive");r--){let p=s.data.items[r],g=p._auction,b=services.Localization.localizeAuctionTimeRemaining(g.expires),h=p.type,{id:v}=p._metaData||{},w=parseInt(p.rating);if(u&&"player"===h){const t=y(`${p.definitionId}_${l.toLowerCase()}_price`);if(!t||!t.price){ei(`Price unavailable for ${p._staticData.name}`,Ae);continue}{const n=Si(t.price*o/100);d=n,e.idAbBidFutBin&&(c=n)}}let S=g.buyNowPrice,$=g.currentBid||g.startingBid,A=g.currentBid,C=e.idAbBidExact?c:A?$i(c):c,T=e.idAbBidExact?C:A?Ai($):$,x=e.idAbSellPrice,B=e.idAbMinRating,P=e.idAbMaxRating,I=p._staticData.name;const _=!(B||P)||(f=P,(m=w)>=B&&m<=f),M=Ri(`${I}(${w}) Prix: ${S} temps: ${b}`);if(!e.idAbIgnoreAllowToggle&&a.has(v)||e.idAbIgnoreAllowToggle&&!a.has(v)){M("(Joueur ignoré)");continue}if(!t){M("(Seuil de résultats de recherche dépassé)");continue}if(i<1)break;if(!p.preferredPosition&&e.idAbAddFilterGK){M("(est un Gardien)");continue}if(!_){M("(la note ne correspond pas aux critères)");continue}if(Fi.has(g.tradeId)){M("(Cached Item)");continue}const D=services.User.getUser().coins.amount;if(!c&&D<S||c&&D<T)M("(Coins insuffisants pour acheter/enchérir)");else if(S<=d)M("essaye d'achat à: "+S),i--,Fi.add(g.tradeId),await Ii(p,I,S,x,!0,g.tradeId);else if(c&&$<=C){if(g.expires>n){M("(Attente de l'heure d'expiration spécifiée)");continue}M("tentative d'enchère à: "+T),Fi.add(g.tradeId),i--,await Ii(p,I,T,x,T===S,g.tradeId)}else M(d&&S>d||c&&$>C?`Prix d'achat: ${d||C} (supérieur au prix d'achat/offre spécifié)`:"(Aucune action requise)")}}else((e,t,n)=>{let i=!1;if(e.status===UtasErrorCode.CAPTCHA_REQUIRED||e.error&&e.error.code==UtasErrorCode.CAPTCHA_REQUIRED)i=!0,t?(ei("[!!!] Captcha got triggered, trying to solve it",Ae),Ni()):Zn(n);else{const t=w("searchFailedCount");t>=3?(i=!0,ei(`[!!!] Autostopping bot as search failed for ${t} consecutive times, please check if you can access transfer market in Web App ${e.status}`,Ae)):ei(`[!!!] Search failed - ${e.status}`,Ae)}i&&(k("capatcha"),zi())})(s,e.idAbSolveCaptcha,e.idAbCloseTabToggle);var m,f;Vn("Transfer Market Search"),r<e.idAbMaxSearchPage&&21===s.data.items.length?w("currentPage"):h("currentPage",1),t()}))}))},Ri=e=>t=>{ei(e+" "+t,Ae)},ki=function(e,t,n){return Vn("Transfer List - List View"),new Promise((i=>{n||repositories.Item.isDirty(ItemPile.TRANSFER)?services.Item.requestTransferItems().observe(this,(async function(n,s){let o=s.response.items.filter((function(e){return e.getAuctionData().isSold()})).length;jt("soldItems")<o&&await ii(),zt("soldItems",o);const r=s.response.items.filter((function(e){return!e.getAuctionData().isSold()&&e.getAuctionData().isExpired()})).length;zt("unsoldItems",r);const a=o>=t;r&&e&&services.Item.relistExpiredAuctions().observe(this,(function(e,t){!a&&UTTransferListViewController.prototype.refreshList()}));const l=s.response.items.filter((function(e){return e.getAuctionData().isSelling()})).length;zt("activeTransfers",l);const c=s.response.items.filter((function(e){return e.getAuctionData().isInactive()})).length;zt("availableItems",c);const d=services.User.getUser().coins.amount;zt("coinsNumber",d),zt("coins",d.toLocaleString()),a&&(ei("[TRANSFER-LIST] > "+o+" item(s) sold\n",Ae),UTTransferListViewController.prototype._clearSold()),i()})):i()}))},Ui=function(){return{switchFilterWithContext:ai.bind(this),srchTmWithContext:Ei.bind(this),watchListWithContext:Mi.bind(this),transferListWithContext:ki.bind(this),pauseBotWithContext:ri.bind(this)}},Li=async()=>{const e=y("sellQueue")||[],t=v();t.idAbSendListingNotificationToggle,e.length;for(;e.length;){const{player:n,sellPrice:i,shouldList:s,playerName:o,profit:r}=e.pop();await Wi(n,i,r,s,t);e.length&&await T(2)}},Wi=(e,t,n,i,s)=>new Promise((o=>{if(t<0)services.Item.move(e,ItemPile.TRANSFER).observe(void 0,(async function(){o()}));else if(i){if(repositories.Item.isPileFull(ItemPile.TRANSFER))return o("Unable to list, transfer List if Full");(e=>{const t=y("sessionStats");t.profit+=e,h("sessionStats",t)})(n),services.Item.list(e,$i(t),t,N(s.idFutBinDuration||"1H")||3600).observe(void 0,(async function(e,t){o()}))}else services.Item.move(e,ItemPile.CLUB).observe(void 0,(async function(e,t){o()}))}));let Oi=null,Vi=null;const Hi=async function(e){$("#"+Le).css("color","#2cbe2d").html("RUNNING");if(y("autoBuyerActive"))return;(e=>{On(e?"Autobuyer Resumed":"Autobuyer Started"),h("autoBuyerActive",!0),h("autoBuyerState","Active"),isPhone()&&$(".ut-tab-bar-item").attr("disabled",!0),e||(h("botStartTime",new Date),h("purchasedCardCount",0),h("searchFailedCount",0),h("currentPage",1))})(e);const{switchFilterWithContext:t,srchTmWithContext:n,watchListWithContext:i,transferListWithContext:s,pauseBotWithContext:o}=Ui.call(this);await t();let r=v();!e&&await new Promise(((e,t)=>{services.Item.requestWatchedItems().observe(void 0,(function(t,n){if(n.success){const e=y("filterBidItems")||new Map,t=new Set(Array.from(e.values()).flat(1).reduce(((e,t)=>e.concat([...t])),[])),i=n.response.items.filter((e=>e._auction&&!t.has(e._auction.tradeId))).map((e=>e._auction.tradeId))||[];h("userWatchItems",new Set(i)),i.length&&ei(`${i.length} élément(s) trouvé(s) dans la liste d'objectifs de transferts et ignoré(s)`,Ae)}e()}))})),Vn("Hub - Transfers"),await n(r),Vn("Hub - Transfers"),await s(r.idAbSellToggle,r.idAbMinDeleteCount,!0);let a=!1;y("autoBuyerActive")&&(Oi=((e,t,n)=>{let i,s=!1;const o=()=>{if(s)return;const r={start:Date.now()},a=1e3*parseFloat((Math.random()*(n-t)+t).toFixed(1));r.end=r.start+a,h("searchInterval",r),i=setTimeout((()=>{e(),o()}),a)};return o(),{clear(){s=!0,clearTimeout(i)}}})((async()=>{Vi=o(r),(e=>{const t=y("purchasedCardCount"),n=e.idAbCardCount,i=y("botStartTime").getTime();let s=si||_(e.idAbStopAfter);si||(si=s);let o=((new Date).getTime()-i)/1e3>=s;(o||n&&t>=n)&&(ei("Autobuyer stopped | "+(o?"Time elapsed":"Max purchases count reached"),Ae),si=null,oi=null,zi())})(r);y("autoBuyerActive")&&!a&&(a=!0,await Li(),await t(),r=v(),Vn("Hub - Transfers"),await n(r),Vn("Hub - Transfers"),await i(r),Vn("Hub - Transfers"),await s(r.idAbSellToggle,r.idAbMinDeleteCount)),a=!1}),...E(r.idAbWaitTime)))},zi=e=>{Oi&&Oi.clear(),!e&&Vi&&clearTimeout(Vi);const t=y("autoBuyerState");if(e&&t===i||!e&&t===s)return;h("autoBuyerActive",!1);const n=y("searchInterval")||{};h("searchInterval",{start:n.start,end:Date.now()}),e||k("finish"),isPhone()&&$(".ut-tab-bar-item").removeAttr("disabled"),h("autoBuyerState",e?i:s),On(e?"Autobuyer Paused":"Autobuyer Stopped"),e||Li(),$("#"+Le).css("color","red").html(e?"PAUSED":"IDLE")},ji=()=>`<div class="view-navbar-currency">\n            <span id=${xt} style="font-weight: bold;\n            margin: auto 2px;">00:00:00</span>\n            <div style="margin: auto 2px;">Search:</div> \n            <div class="stats-progress">\n              <div id=${Fe} class="stats-fill"></div>\n            </div>\n            <div class="view-navbar-currency-coins ab">Coins: <span id=${ke}></span></div>\n            <div class="view-navbar-currency-coins ab">Profit: <span id=${lt}></span></div>\n            <div class="view-navbar-currency-coins ab">Won: <span id=${Ue}></span></div>\n            ${rn(Bt,"⇩",(()=>{Bi()}),"filterSync download-stats")} \n          </div>`,Ji=()=>`\n  <div class="view-navbar-clubinfo-data">\n    <div class="view-navbar-clubinfo-name">\n    ${rn(Bt,"⇩",(()=>{Bi()}),"filterSync")}\n    </div>\n  </div>\n  <div class="view-navbar-clubinfo">\n    <div class="view-navbar-clubinfo-data">\n      <div class="view-navbar-clubinfo-name">\n        <span id=${xt} style="font-weight: bold;">00:00:00</span>\n      </div>\n    </div>\n  </div>\n  <div class="view-navbar-clubinfo">\n    <div class="view-navbar-clubinfo-data">\n       <div class="view-navbar-clubinfo-name">\n          <div style="float: left;">Search:</div>\n          <div class="stats-progress">\n             <div id=${Fe} class="stats-fill"></div>\n          </div>\n       </div>\n       <div class="view-navbar-clubinfo-name">\n          <div style="float: left;">Statistics:</div>\n          <div class="stats-progress">\n             <div id=${Ee} class="stats-fill"></div>\n          </div>     \n       </div>\n    </div>\n  </div>\n  <div class="view-navbar-currency" style="margin-left: 10px;">\n    <div class="view-navbar-currency-coins ab">Coins: <span  id=${ke}></span></div>\n    <div class="view-navbar-currency-coins ab">Profit: <span  id=${lt}></span></div>\n    <div class="view-navbar-currency-coins ab">Won: <span id=${Ue}></span></div>\n  </div>\n  <div class="view-navbar-clubinfo">\n    <div class="view-navbar-clubinfo-data">\n       <span class="view-navbar-clubinfo-name">Sold Items: <span id=${We}></span></span>\n       <span class="view-navbar-clubinfo-name">Unsold Items: <span id=${Oe}></span></span>\n    </div>\n  </div>\n  <div class="view-navbar-clubinfo" style="border: none;">\n    <div class="view-navbar-clubinfo-data">\n       <span class="view-navbar-clubinfo-name">Available Items: <span id=${Ve}></span></span>\n       <span class="view-navbar-clubinfo-name">Active transfers: <span id=${He}></span></span>\n    </div>\n  </div>`,{R:Gi,T:qi}=t,Yi=function(e){UTMarketSearchFiltersViewController.call(this)},Xi=UTMarketSearchFiltersViewController.prototype.init,Ki=UTMarketSearchFiltersViewController.prototype.viewDidAppear;JSUtils.inherits(Yi,UTMarketSearchFiltersViewController),JSUtils.inherits(UTMarketSearchFiltersViewController,UTMarketSearchFiltersViewController),Yi.prototype.init=function(){Xi.call(this);let e=this.getView();isPhone()||(e.__root.style="width: 52%; float: left;"),h("AutoBuyerInstance",this);const t=Tn.call(this);let n=$(e.__root);const i=Jt.bind(this),s=i("Stop",(()=>qi.call(this))),o=i("Clear Log",(()=>ti.call(this)),"btn-other"),r=i("Start",(()=>{Gi.call(this),$(".ut-navigation-container-view--content").animate({scrollTop:$(".ut-navigation-container-view--content").prop("scrollHeight")},400)}),"call-to-action");setInterval((()=>{isPhone()?Ot():Vt()}),1e3),n.addClass("auto-buyer");const a=n.find(".button-container");a.addClass("buyer-actions"),a.find(".call-to-action").remove();const l=a.find('button:contains("Reset")');l.on("click touchend",(async function(){$(`#${W}`).prop("selectedIndex",0),await xn()})),l.addClass("btn-other"),a.append($(r.__root)),a.append($(s.__root)),a.append($(o.__root)),$(t.__root).find(".menu-container").addClass("settings-menu"),n.find(".search-prices").append(t.__root)},Yi.prototype.viewDidAppear=function(){this.getNavigationController().setNavigationVisibility(!0,!0),Qi.call(this,!1)},UTMarketSearchFiltersViewController.prototype.viewDidAppear=function(){Qi.call(this,!0)};const Qi=function(e){Ki.call(this);let t=this.getView(),n=$(t.__root);n.find(".filter-place").length||wn.call(this,e).then((e=>{n.find(".ut-item-search-view").first().prepend(e)}))};Yi.prototype.getNavigationTitle=function(){return setTimeout((()=>{const e=$(".title");isPhone()&&e.addClass("buyer-header"),$(".view-navbar-currency").remove(),$(".view-navbar-clubinfo").remove(),e.append(`<span style='color:red' id="${Le}"> IDLE </span> | REQUEST COUNT: <span id="${Re}">0</span> \n  `),$(isPhone()?ji():Ji()).insertAfter(e),$(".ut-navigation-container-view--content").find(`#${kt}`).remove(),$(".ut-navigation-container-view--content").append((()=>{const e=$(`<div style=${isPhone()?"height: 90%;display: flex;flex-direction: column;padding: 7px;":"width:48%"} id=${kt}>\n            <div class="logs-container">\n              <div data-title="Clear logs" class="button-clear">\n              </div>\n            </div>\n            <br/>\n            <div class="logWrapper">\n            <ul wrap="off"  style="height: 100%;overflow-x: auto;resize: none; width: 100%;" id=${Ae} class="autoBuyerLog"></ul>\n            <br/>\n        </div>`);return e.find(".button-clear").append(Jt("⎚",(()=>ti())).__root),e})()),Gt(),L(y("CommonSettings")||{})})),"MagicBuyer "};const Zi=()=>{const e=UTGameTabBarController.prototype.initWithViewControllers;UTGameTabBarController.prototype.initWithViewControllers=function(t){const n=new UTGameFlowNavigationController;n.initWithRootController(new Yi),n.tabBarItem=ts("MagicBuyer"),(t=es(t)).push(n),e.call(this,t)}},es=e=>{if(!isPhone())return e;const t=[];return t.push(e[0]),t.push(e[2]),t.push(e[3]),t.push(e[4]),t},ts=e=>{const t=new UTTabBarItemView;return t.init(),t.setTag(8),t.setText(e),t.addClass("icon-transfer"),t},ns=()=>{const e=UTNavigationBarView.prototype.layoutSubviews;function t(){const e=new UTNavigationButtonControl;return e.init(),e.addClass("menu-btn"),e.setInteractionState(!0),e.addTarget(this,(()=>{window.ReactNativeWebView.postMessage(JSON.stringify({type:"OpenDrawer"}))}),EventType.TAP),e}UTNavigationBarView.prototype.layoutSubviews=function(...n){const i=e.call(this,...n);if(this.primaryButton&&this.__clubInfo){this._menuBtn&&this._menuBtn.removeFromSuperview(),this._menuBtn=t.call(this);const e=$(this.primaryButton.getRootElement()),n=$(this._menuBtn.getRootElement());$(".top-nav").remove(),e.wrap('<div class="top-nav"></div>'),n.insertBefore(e)}return i}};n(897);const is=()=>{d(),Zi(),isPhone()&&ns(),A()},ss=()=>"\n  ::-webkit-scrollbar {\n    -webkit-appearance: none;\n  }\n  ::-webkit-scrollbar:vertical {\n      width: 12px;\n  }\n  ::-webkit-scrollbar:horizontal {\n      height: 12px;\n  }\n  ::-webkit-scrollbar-thumb {\n      background-color: rgba(0, 0, 0, .5);\n      border-radius: 10px;\n      border: 2px solid #ffffff;\n  }\n  ::-webkit-scrollbar-track {\n      border-radius: 10px;\n      background-color: #ffffff;\n  }",os=function(){let e=!1;isPhone()&&$("body").removeClass("landscape").addClass("phone"),$(".ui-orientation-warning").attr("style","display: none !important"),$(".ut-fifa-header-view").attr("style","display: none !important"),services.Localization&&$("h1.title").html()===services.Localization.localize("navbar.label.home")&&(e=!0),e?(()=>{const e=document.createElement("style");$(".ui-orientation-warning").css("display","none"),$(".ut-fifa-header-view").css("display","none"),e.innerText=`\n  .buyer-header {\n      font-size: 20px !important;\n  }\n  .with-fifa-header .ut-root-view {\n    height: 100%;\n  }\n  .buyer-settings {\n      width: 100%;\n  }\n  .buyer-settings-field {\n    margin-top: 15px;\n    margin-bottom: 15px;\n  }\n  .phone .buyer-settings-field{\n    margin-top: auto;\n    margin-bottom: auto;\n    width: 100%;\n    padding: 10px;\n  }\n  .buyer-settings-wrapper {\n    display: flex; \n    flex-wrap: wrap; \n    margin-top: 20px;\n  }\n  .buyer-settings-field .ut-toggle-cell-view{\n    justify-content: center;\n  }\n  .buyer-settings-field input:disabled {\n    background-color: #c3c6ce;\n    cursor: not-allowed;\n  }\n  .btn-test-notification\n  {\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n  input[type="number"]{\n    padding: 0 .5em;\n    border-radius: 0;\n    background-color: #262c38;\n    border: 1px solid #4ee6eb;\n    box-sizing: border-box;\n    color: #4ee6eb;\n    font-family: UltimateTeam,sans-serif;\n    font-size: 1em;\n    height: 2.8em;\n    opacity: 1;\n    width: 100%;\n  }\n  .autoBuyerLog {\n    font-size: ${isPhone()?"13px":"15px"}; \n    height: 50%;\n  }\n  .cardPalyerLi {\n    width: 100%;\n  }\n  .cardPalyer {\n    transition: 0.3s;\n    width: 80%;\n    background: #222F3E;\n    color: white;\n    margin-bottom: 1%;\n    font-size: 1rem;\n    border-radius: 30px;\n    display: flex;\n    border: solid #2E86DE;\n  }\n  .cardPalyer:hover {\n    box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);\n  }\n  .container {\n    display: flex;\n    width: 100%;\n  }\n  .contentContainer {\n    padding: 4%;\n    width: 100%;\n  }\n  .typeContent {\n    width: 300px;\n    background: #2E86DE;\n    height: 100%;\n    border-radius: 30px;\n    border-radius-right: 20px;\n    border-top-right-radius: 20px;\n    border-bottom-right-radius: 20px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n  .typeContentText {\n    font-size: 7rem;\n    color: #C8D6E5;\n  }\n  .searchLog {\n    font-size: 10px; \n    height: 50%;\n  }\n  input::-webkit-outer-spin-button,\n  input::-webkit-inner-spin-button {\n    -webkit-appearance: none;\n    margin: 0;\n  }\n  input[type=number] {\n    -moz-appearance: textfield;\n  }\n  .captcha-settings-view input,\n  .notification-settings-view input {\n    text-transform: none;\n  }\n  .phone .buyer-header{\n    font-size: 1.2em !important;\n  }\n  .phone .buyer-actions .btn-standard{\n    padding: 0;\n    font-size: 1.2em;\n    text-overflow: unset;\n  }\n  .filter-header-settings {\n    width: 100%;\n    padding: 10px;\n    font-family: UltimateTeamCondensed, sans-serif;\n    font-size: 1.6em;\n    color: #e2dde2;\n    text-transform: uppercase;\n    background-color: #171826;\n  }\n  .btn-save-filter {\n    width:100%\n  }\n  .btn-delete-filter {\n    width:50%\n  }\n  .multiple-filter {\n    width: 100%  !important;\n    display: flex  !important;\n    justify-content: center;\n    align-items: center;\n  }\n  .logs-container {\n    display: flex;\n    justify-content: space-between;\n    font-size: 20px;\n    align-items: center;\n  }\n  .button-clear button {\n    color: #fff;\n    background-color: unset;\n    height: unset;\n    line-height: unset;\n  }\n  .top-nav{\n    display:flex; \n  }\n  .ut-navigation-button-control.menu-btn:before {\n    content: "≡";\n    transform: unset;\n  }\n  .menu-btn {\n    min-width: 0px;\n    margin-left: 5px;\n  }\n  .filterSync {\n    background: transparent;\n    color: #c4f750;\n    text-overflow: clip;\n  }\n  .filterSync:hover {\n    background: transparent !important;\n  }\n  .stats-progress {\n    float: right; \n    height: 10px; \n    width: 100px; \n    background: #888; \n    margin: ${isPhone()?"auto 5px":"5px 0px 5px 5px"};\n  }\n  .stats-fill {\n    background: #000; \n    height: 10px; \n    width: 0%\n  }\n  .numericInput:invalid {\n    color: red;\n    border: 1px solid;\n  }\n  .ignore-players{\n    width: 100%;\n    display: flex;\n    background: transparent;\n  }\n  .ignore-players .ut-player-search-control{\n    width: 90% !important;\n  }\n  .ignore-players filterSync{\n    flex: unset;\n  }\n  .font15 {\n    font-size: 15px;\n  }  \n  .action-icons {\n    display: unset !important;\n    width: 10%\n  }\n  .displayCenterFlx {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  }\n  .displayNone {\n    height: 275px;\n  }\n  .displayNone .inline-list-select,\n  .displayNone .search-prices,\n  .displayNone .btn-actions,\n  .displayNone .btn-filters,\n  .displayNone .btn-report,\n  .displayNone .buyer-actions .btn-other {\n    display: none !important;\n  }\n  .mrg10 {\n    margin: 10px;\n  }\n  .ut-toggle-cell-view--label{\n    overflow: unset;\n  }\n  .download-stats {\n    line-height: 1;\n    display: flex;\n  }\n  .btn-report {\n    display: flex;\n    justify-content: center;\n  }\n  small{\n    white-space: break-spaces;\n  }  \n  .joinServer {\n    position: absolute;\n    right: 25px;\n    top: 50%;\n    color: wheat\n  }\n  .phone .joinServer{\n    display: none;\n  }\n  textarea {\n    resize: none;\n  }  \n  .logWrapper {\n    position: relative;\n    height: 100%\n  }\n  .ut-navigation-bar-view .view-navbar-currency-coins.ab:before {\n    content: unset !important;\n  }\n  .ut-navigation-bar-view .view-navbar-currency-coins.ab {\n    cursor: unset !important;\n  } \n  .auto-buyer .autoBuyMin{\n    display: none;\n  }\n  .auto-buyer .search-prices .settings-field{\n    display: none;\n  }\n  `,e.innerText+=ss(),document.head.appendChild(e)})():setTimeout(os,1e3)},rs=function(){let e=!1;services.Localization&&(e=!0),e?(is(),os(),l&&window.addEventListener("message",(e=>{const t=JSON.parse(e.data);if("dataFromExternalAB"===t.type){const{res:e,identifier:n}=t.response,i=y(n);return i&&i(e),h(n,null)}}),!0)):setTimeout(rs,1e3)};rs()})()})();